name: 'Test Terraform Pipeline'

on:
  push:
    branches:
      - main
      - develop
      - 'feature/Staging-pipeline'  # Temporary for testing
    paths:
      - '**.tf'
      - '**.tfvars'
      - '.github/workflows/**'
  
  workflow_dispatch:

permissions:
  id-token: write
  contents: read

jobs:
  test-authentication:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Azure Login Test
        uses: azure/login@v1
        with:
          client-id: ${{ secrets.AZURE_CLIENT_ID }}
          tenant-id: ${{ secrets.AZURE_TENANT_ID }}
          subscription-id: a8912e4d-93c4-4867-ab0d-1095943662fd  # Dev subscription for testing

      - name: Test Azure Connection
        run: |
          echo "Testing Azure connection..."
          az account show
          echo "âœ… Azure OIDC authentication successful!"

      - name: Setup Terraform
        uses: hashicorp/setup-terraform@v3
        with:
          terraform_version: '1.6.0'

      - name: Terraform Version
        run: terraform version

      - name: Test Complete
        run: |
          echo "ðŸŽ‰ Pipeline test successful!"
          echo "âœ… GitHub secrets configured correctly"
          echo "âœ… Azure OIDC authentication working"  
          echo "âœ… Terraform setup working"
          echo ""
          echo "Your deployment pipeline is ready for full configuration!"
